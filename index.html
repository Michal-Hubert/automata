<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Random Walk Food Search</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script src="random_walk.js"></script>
  <script src="levy_flight.js"></script>
  <script src="bfs.js"></script>
  <style>
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #1a1a2e;
      font-family: Arial, sans-serif;
      color: white;
      padding: 20px;
    }
    #info {
      margin-bottom: 10px;
      font-size: 18px;
    }
    #controls {
      margin-top: 10px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background: #4a90d9;
      border: none;
      color: white;
      border-radius: 5px;
      margin: 5px;
    }
    button:hover {
      background: #357abd;
    }
    select {
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
      background: #4a90d9;
      border: none;
      color: white;
      border-radius: 5px;
      margin: 5px;
    }
    select:hover {
      background: #357abd;
    }
  </style>
</head>
<body>
  <div id="info">Steps: <span id="steps">0</span> | Status: <span id="status">Searching...</span></div>
  <div id="canvas-container"></div>
  <div id="controls">
    <select id="simType" onchange="changeSimType()">
      <option value="random_walk">Random Walk</option>
      <option value="levy_flight">LÃ©vy Flight</option>
      <option value="bfs">BFS (Expanding Circle)</option>
    </select>
    <button onclick="restart()">Restart</button>
    <button onclick="toggleSpeed()">Speed: <span id="speedLabel">Normal</span></button>
  </div>

  <script>
    const CANVAS_SIZE = 600;
    const FOOD_COUNT = 10;
    const FOOD_RADIUS = 10;
    const WALKER_RADIUS = 8;

    let walker;
    let foods = [];
    let steps = 0;
    let found = false;
    let speed = 1;
    let simType = 'random_walk';
    let trail = []; // Store walker's path

    function setup() {
      let canvas = createCanvas(CANVAS_SIZE, CANVAS_SIZE);
      canvas.parent('canvas-container');
      initSimulation();
    }

    function initSimulation() {
      walker = { x: CANVAS_SIZE / 2, y: CANVAS_SIZE / 2 };
      trail = [{ x: walker.x, y: walker.y }]; // Reset trail with starting position
      BFS.reset(CANVAS_SIZE / 2, CANVAS_SIZE / 2);

      foods = [];
      for (let i = 0; i < FOOD_COUNT; i++) {
        let food;
        let validPosition = false;

        while (!validPosition) {
          food = {
            x: random(FOOD_RADIUS, CANVAS_SIZE - FOOD_RADIUS),
            y: random(FOOD_RADIUS, CANVAS_SIZE - FOOD_RADIUS),
            eaten: false
          };

          let distToCenter = dist(food.x, food.y, CANVAS_SIZE / 2, CANVAS_SIZE / 2);
          if (distToCenter > 50) {
            validPosition = true;
          }
        }
        foods.push(food);
      }

      steps = 0;
      found = false;
      updateDisplay();
    }

    function draw() {
      background(26, 26, 46);

      // Draw grid
      stroke(40, 40, 60);
      strokeWeight(1);
      for (let i = 0; i < CANVAS_SIZE; i += 50) {
        line(i, 0, i, CANVAS_SIZE);
        line(0, i, CANVAS_SIZE, i);
      }

      // Draw trail
      noFill();
      stroke(255, 100, 100, 150);
      strokeWeight(2);
      beginShape();
      for (let pos of trail) {
        vertex(pos.x, pos.y);
      }
      endShape();

      // Draw food
      for (let food of foods) {
        if (!food.eaten) {
          fill(50, 205, 50);
          stroke(34, 139, 34);
          strokeWeight(2);
          ellipse(food.x, food.y, FOOD_RADIUS * 2);
        }
      }

      // Draw walker
      fill(255, 100, 100);
      stroke(200, 50, 50);
      strokeWeight(2);
      ellipse(walker.x, walker.y, WALKER_RADIUS * 2);

      // Move walker if not found food yet
      if (!found) {
        for (let i = 0; i < speed; i++) {
          moveWalker();
          checkFood();
          if (found) break;
        }
      }
    }

    function moveWalker() {
      let nextPos;

      if (simType === 'random_walk') {
        nextPos = RandomWalk.getNextPosition(walker.x, walker.y);
      } else if (simType === 'levy_flight') {
        nextPos = LevyFlight.getNextPosition(walker.x, walker.y);
      } else {
        nextPos = BFS.getNextPosition(walker.x, walker.y);
      }

      // Bounce off walls (for random walk and levy flight)
      // BFS uses absolute positioning so we still clamp to bounds
      if (nextPos.x >= WALKER_RADIUS && nextPos.x <= CANVAS_SIZE - WALKER_RADIUS) {
        walker.x = nextPos.x;
      }
      if (nextPos.y >= WALKER_RADIUS && nextPos.y <= CANVAS_SIZE - WALKER_RADIUS) {
        walker.y = nextPos.y;
      }

      // Record position in trail
      trail.push({ x: walker.x, y: walker.y });

      steps++;
      updateDisplay();
    }

    function checkFood() {
      for (let food of foods) {
        if (!food.eaten) {
          let d = dist(walker.x, walker.y, food.x, food.y);
          if (d < FOOD_RADIUS + WALKER_RADIUS) {
            food.eaten = true;
            found = true;
            document.getElementById('status').textContent = 'Food found!';
            document.getElementById('status').style.color = '#32cd32';
            return;
          }
        }
      }
    }

    function updateDisplay() {
      document.getElementById('steps').textContent = steps;
    }

    function restart() {
      document.getElementById('status').textContent = 'Searching...';
      document.getElementById('status').style.color = 'white';
      initSimulation();
    }

    function toggleSpeed() {
      if (speed === 1) {
        speed = 10;
        document.getElementById('speedLabel').textContent = 'Fast';
      } else if (speed === 10) {
        speed = 50;
        document.getElementById('speedLabel').textContent = 'Very Fast';
      } else {
        speed = 1;
        document.getElementById('speedLabel').textContent = 'Normal';
      }
    }

    function changeSimType() {
      simType = document.getElementById('simType').value;
      // Reset walker position and step count, but keep food locations
      walker = { x: CANVAS_SIZE / 2, y: CANVAS_SIZE / 2 };
      trail = [{ x: walker.x, y: walker.y }]; // Reset trail
      BFS.reset(CANVAS_SIZE / 2, CANVAS_SIZE / 2);
      steps = 0;
      found = false;
      // Reset eaten status so food can be found again
      for (let food of foods) {
        food.eaten = false;
      }
      document.getElementById('status').textContent = 'Searching...';
      document.getElementById('status').style.color = 'white';
      updateDisplay();
    }
  </script>
</body>
</html>
